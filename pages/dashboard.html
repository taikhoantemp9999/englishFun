<!DOCTYPE html>
<html lang="vi">

<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>üìä Ti·∫øn ƒë·ªô h·ªçc t·∫≠p - English Fun</title>
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet" />
  <style>
    html,
    body {
      height: 100%;
      background: #f7fafc;
    }

    .container-main {
      max-width: 1200px;
      margin: 0 auto;
      padding: 20px;
    }

    .header-nav {
      background: #fff;
      border-radius: 12px;
      padding: 15px 25px;
      margin-bottom: 25px;
      box-shadow: 0 2px 8px rgba(0, 0, 0, 0.08);
      display: flex;
      justify-content: space-between;
      align-items: center;
    }

    .nav-title {
      font-size: 1.5rem;
      font-weight: bold;
      color: #333;
    }

    .stat-item {
      padding: 10px;
    }

    .stat-item h3 {
      margin: 0;
      font-size: 2rem;
      font-weight: bold;
    }

    .lesson-progress-item {
      border-bottom: 1px solid #e9ecef;
      padding-bottom: 15px;
    }

    .lesson-progress-item:last-child {
      border-bottom: none;
    }

    .card {
      box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
      border: none;
      margin-bottom: 20px;
    }

    .card-header {
      font-weight: bold;
    }
  </style>
</head>

<body>
  <!-- Header v·ªõi menu ƒëi·ªÅu h∆∞·ªõng -->
  <div class="header-nav">
    <div class="nav-title">üìä Ti·∫øn ƒë·ªô h·ªçc t·∫≠p</div>
    <div>
      <a href="../index.html" class="btn btn-outline-primary btn-sm me-2">üè† Trang ch·ªß</a>
      <a href="../index.html#lessons" class="btn btn-outline-success btn-sm">üìö H·ªçc b√†i</a>
    </div>
  </div>

  <!-- N·ªôi dung dashboard -->
  <div class="container-main">
    <div id="dashboard-content">
      <div class="text-center">
        <div class="spinner-border text-primary" role="status">
          <span class="visually-hidden">ƒêang t·∫£i...</span>
        </div>
        <p class="mt-3">ƒêang t·∫£i d·ªØ li·ªáu ti·∫øn ƒë·ªô...</p>
      </div>
    </div>
  </div>

  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
  <script>
    // ===== H√ÄM L·∫§Y PROGRESS (FIREBASE PRIORITY) =====
    async function getProgress() {
      // Priority 1: Load from Firebase
      if (typeof ProgressManager !== 'undefined' && ProgressManager.userId) {
        try {
          await ProgressManager.load();
          console.log('üìä Loaded progress from Firebase:', ProgressManager.data.progress.length, 'items');
          return ProgressManager.data;
        } catch (e) {
          console.error('‚ùå Error loading from Firebase:', e);
        }
      }

      // Priority 2: localStorage
      const d = localStorage.getItem("progressData");
      if (d) {
        try {
          const parsed = JSON.parse(d);
          if (parsed && parsed.progress && Array.isArray(parsed.progress)) {
            console.log('üìÇ Loaded progress from localStorage:', parsed.progress.length, 'items');
            return parsed;
          }
        } catch (e) {
          console.error("L·ªói parse progress:", e);
        }
      }

      // Priority 3: file
      try {
        const response = await fetch('../data/progress.json');
        if (response.ok) {
          const fileData = await response.json();
          if (fileData && fileData.progress) {
            localStorage.setItem("progressData", JSON.stringify(fileData));
            console.log('üìÑ Loaded progress from file:', fileData.progress.length, 'items');
            return fileData;
          }
        }
      } catch (e) {
        console.error("L·ªói ƒë·ªçc file progress:", e);
      }

      console.log('üìù No progress data found, starting fresh');
      return { progress: [] };
    }

    // ===== H√ÄM L·∫§Y D·ªÆ LI·ªÜU B√ÄI H·ªåC =====
    async function getLessonsData() {
      try {
        const response = await fetch('../data/lessons.json');
        return await response.json();
      } catch (e) {
        console.error("L·ªói ƒë·ªçc lessons:", e);
        return { lessons: [] };
      }
    }

    // ===== T√çNH TO√ÅN TH·ªêNG K√ä H·ªåC T·∫¨P =====
    function calculateLearningStats(progress, lessonsData) {
      if (!progress || !progress.progress || !Array.isArray(progress.progress)) {
        return {
          totalItems: 0,
          masteredItems: 0,
          goodItems: 0,
          needReviewItems: 0,
          averageItems: 0,
          weakItems: 0,
          newItems: 0,
          learningItems: 0,
          masteryPercentage: 0,
          lessonStats: {},
          dueItems: [],
          achievements: [],
          dailyProgress: []
        };
      }

      const stats = {
        totalItems: progress.progress.length,
        masteredItems: 0,
        goodItems: 0,
        needReviewItems: 0,
        averageItems: 0,
        weakItems: 0,
        newItems: 0,
        learningItems: 0,
        masteryPercentage: 0,
        lessonStats: {},
        dueItems: [],
        achievements: [],
        dailyProgress: []
      };

      const MIN_ATTEMPTS_FOR_MASTERY = 5;

      progress.progress.forEach(item => {
        const correct = item.correct || 0;
        const wrong = item.wrong || 0;
        const total = correct + wrong;
        const accuracy = total > 0 ? (correct / total) * 100 : 0;

        const isFullyMastered = accuracy >= 80 && total >= MIN_ATTEMPTS_FOR_MASTERY && wrong === 0;

        let itemStatus = 'new';

        if (total === 0) {
          stats.newItems++;
          itemStatus = 'new';
        } else if (isFullyMastered) {
          stats.masteredItems++;
          itemStatus = 'mastered';
        } else if (wrong > 0) {
          stats.needReviewItems++;
          stats.learningItems++;
          itemStatus = 'needReview';
        } else if (accuracy >= 80) {
          stats.goodItems++;
          stats.learningItems++;
          itemStatus = 'good';
        } else if (accuracy >= 50) {
          stats.averageItems++;
          stats.learningItems++;
          itemStatus = 'average';
        } else {
          stats.weakItems++;
          stats.learningItems++;
          itemStatus = 'weak';
        }

        // Th·ªëng k√™ theo b√†i
        const lessonId = item.lessonId || 'unknown';
        if (!stats.lessonStats[lessonId]) {
          stats.lessonStats[lessonId] = {
            total: 0, mastered: 0, good: 0, needReview: 0,
            average: 0, weak: 0, new: 0, learning: 0
          };
        }
        stats.lessonStats[lessonId].total++;
        stats.lessonStats[lessonId][itemStatus]++;
        if (itemStatus !== 'new' && itemStatus !== 'mastered') {
          stats.lessonStats[lessonId].learning++;
        }

        // Ki·ªÉm tra c·∫ßn √¥n
        if (item.nextReview && new Date(item.nextReview) <= new Date()) {
          stats.dueItems.push(item);
        }
      });

      stats.masteryPercentage = stats.totalItems > 0 ?
        Math.round((stats.masteredItems / stats.totalItems) * 100) : 0;

      stats.achievements = calculateAchievements(stats);
      stats.dailyProgress = generateDailyProgressData(progress);

      return stats;
    }

    // ===== T·∫†O HTML CHO TI·∫æN ƒê·ªò THEO B√ÄI =====
    function generateLessonProgressHTML(lessonStats, lessonsData) {
      let html = '';
      Object.keys(lessonStats).forEach(lessonId => {
        const lesson = lessonStats[lessonId];
        const lessonName = getLessonName(lessonId, lessonsData);
        const masteryPercent = lesson.total > 0 ?
          Math.round((lesson.mastered / lesson.total) * 100) : 0;
        const goodPercent = lesson.total > 0 ? (lesson.good / lesson.total * 100).toFixed(1) : 0;
        const needReviewPercent = lesson.total > 0 ? (lesson.needReview / lesson.total * 100).toFixed(1) : 0;
        const averagePercent = lesson.total > 0 ? (lesson.average / lesson.total * 100).toFixed(1) : 0;
        const weakPercent = lesson.total > 0 ? (lesson.weak / lesson.total * 100).toFixed(1) : 0;

        html += `
          <div class="lesson-progress-item mb-3">
            <div class="d-flex justify-content-between align-items-center mb-2">
              <span><strong>${lessonName}</strong></span>
              <span class="badge bg-primary">${lesson.total} t·ª´/c√¢u</span>
            </div>
            <div class="progress" style="height: 20px;">
              <div class="progress-bar bg-success" style="width: ${masteryPercent}%" title="Th√†nh th·∫°o: ${lesson.mastered}">
                ${lesson.mastered > 0 ? lesson.mastered : ''}
              </div>
              <div class="progress-bar bg-info" style="width: ${goodPercent}%" title="T·ªët: ${lesson.good}">
                ${lesson.good > 0 ? lesson.good : ''}
              </div>
              <div class="progress-bar bg-danger" style="width: ${needReviewPercent}%" title="C·∫ßn √¥n: ${lesson.needReview}">
                ${lesson.needReview > 0 ? lesson.needReview : ''}
              </div>
              <div class="progress-bar bg-warning" style="width: ${averagePercent}%" title="TB: ${lesson.average}">
                ${lesson.average > 0 ? lesson.average : ''}
              </div>
              <div class="progress-bar bg-secondary" style="width: ${weakPercent}%" title="Y·∫øu: ${lesson.weak}">
                ${lesson.weak > 0 ? lesson.weak : ''}
              </div>
            </div>
            <div class="d-flex justify-content-between mt-2 small">
              <span class="text-success">üü¢ ${lesson.mastered}</span>
              <span class="text-info">üîµ ${lesson.good}</span>
              <span class="text-danger">üî¥ ${lesson.needReview}</span>
              <span class="text-warning">üü° ${lesson.average}</span>
              <span class="text-secondary">‚ö™ ${lesson.weak}</span>
              <span class="text-muted">‚ö´ ${lesson.new}</span>
            </div>
          </div>
        `;
      });
      return html || '<p class="text-muted">Ch∆∞a c√≥ d·ªØ li·ªáu</p>';
    }

    function getLessonName(lessonId, lessonsData) {
      if (!lessonsData || !lessonsData.lessons) return `B√†i ${lessonId}`;
      const lesson = lessonsData.lessons.find(l => l.id == lessonId);
      return lesson ? lesson.title : `B√†i ${lessonId}`;
    }

    // ===== DANH S√ÅCH C·∫¶N √îN =====
    function generateReviewListHTML(dueItems) {
      if (dueItems.length === 0) {
        return '<p class="text-success">üéâ Tuy·ªát v·ªùi! Kh√¥ng c√≥ t·ª´/c√¢u n√†o c·∫ßn √¥n luy·ªán.</p>';
      }

      let html = '<div class="row">';
      dueItems.slice(0, 12).forEach(item => {
        const itemName = item.type === 'word' ? item.word :
          (item.sentence ? item.sentence.en : 'Unknown');
        const daysOverdue = item.nextReview ?
          Math.floor((new Date() - new Date(item.nextReview)) / (1000 * 60 * 60 * 24)) : 0;

        html += `
          <div class="col-md-6 col-lg-4 mb-2">
            <div class="card border-warning">
              <div class="card-body p-2">
                <h6 class="card-title mb-1">${itemName}</h6>
                <small class="text-muted">
                  ${daysOverdue > 0 ? `‚è∞ Tr·ªÖ ${daysOverdue} ng√†y` : '‚è∞ ƒê·∫øn h·∫°n'}
                </small>
              </div>
            </div>
          </div>
        `;
      });
      html += '</div>';

      if (dueItems.length > 12) {
        html += `<p class="text-center mt-3"><small>C√≤n ${dueItems.length - 12} t·ª´/c√¢u kh√°c...</small></p>`;
      }

      return html;
    }

    // ===== TH√ÄNH T√çCH =====
    function calculateAchievements(stats) {
      const achievements = [];

      if (stats.masteredItems >= 10) {
        achievements.push({
          icon: 'üéì',
          title: 'Th·∫°c sƒ© t·ª´ v·ª±ng',
          description: `ƒê√£ th√†nh th·∫°o ${stats.masteredItems} t·ª´/c√¢u`
        });
      }

      if (stats.totalItems >= 50) {
        achievements.push({
          icon: 'üìö',
          title: 'Ng∆∞·ªùi h·ªçc chƒÉm ch·ªâ',
          description: `ƒê√£ h·ªçc ${stats.totalItems} t·ª´/c√¢u`
        });
      }

      if (stats.masteryPercentage >= 80) {
        achievements.push({
          icon: '‚≠ê',
          title: 'H·ªçc sinh xu·∫•t s·∫Øc',
          description: `T·ª∑ l·ªá th√†nh th·∫°o ${stats.masteryPercentage}%`
        });
      }

      if (stats.dueItems.length === 0) {
        achievements.push({
          icon: 'üî•',
          title: 'Ng∆∞·ªùi h·ªçc ƒë·ªÅu ƒë·∫∑n',
          description: 'Kh√¥ng c√≥ t·ª´/c√¢u n√†o c·∫ßn √¥n'
        });
      }

      return achievements;
    }

    function generateAchievementsHTML(achievements) {
      if (achievements.length === 0) {
        return '<p class="text-muted">Ch∆∞a c√≥ th√†nh t√≠ch n√†o. H√£y ti·∫øp t·ª•c h·ªçc t·∫≠p!</p>';
      }

      let html = '<div class="row">';
      achievements.forEach(achievement => {
        html += `
          <div class="col-md-6 col-lg-4 mb-3">
            <div class="card border-success">
              <div class="card-body text-center">
                <h2 class="mb-2">${achievement.icon}</h2>
                <h6 class="card-title">${achievement.title}</h6>
                <p class="card-text small">${achievement.description}</p>
              </div>
            </div>
          </div>
        `;
      });
      html += '</div>';

      return html;
    }

    // ===== BI·ªÇU ƒê·ªí TI·∫æN ƒê·ªò 7 NG√ÄY =====
    function generateDailyProgressData(progress) {
      const data = [];
      const now = new Date();

      for (let i = 6; i >= 0; i--) {
        const date = new Date(now.getTime() - i * 24 * 60 * 60 * 1000);
        const dateStr = date.toISOString().split('T')[0];

        const studiedToday = progress.progress.filter(item => {
          if (!item.lastReviewed) return false;
          try {
            const reviewDate = new Date(item.lastReviewed).toISOString().split('T')[0];
            return reviewDate === dateStr;
          } catch (e) {
            return false;
          }
        }).length;

        data.push({
          date: dateStr,
          studied: studiedToday,
          label: date.toLocaleDateString('vi-VN', { weekday: 'short' })
        });
      }

      return data;
    }

    function drawProgressChart(dailyData) {
      const canvas = document.getElementById('progressChart');
      if (!canvas) return;

      const ctx = canvas.getContext('2d');
      const width = canvas.width;
      const height = canvas.height;

      ctx.clearRect(0, 0, width, height);

      const maxValue = Math.max(...dailyData.map(d => d.studied), 1);
      const barWidth = width / dailyData.length * 0.8;
      const barSpacing = width / dailyData.length * 0.2;

      dailyData.forEach((data, index) => {
        const barHeight = (data.studied / maxValue) * height * 0.7;
        const x = index * (barWidth + barSpacing) + barSpacing / 2;
        const y = height - barHeight - 30;

        ctx.fillStyle = data.studied > 0 ? '#28a745' : '#e9ecef';
        ctx.fillRect(x, y, barWidth, barHeight);

        ctx.fillStyle = '#333';
        ctx.font = '12px Arial';
        ctx.textAlign = 'center';
        ctx.fillText(data.studied.toString(), x + barWidth / 2, y - 5);
        ctx.fillText(data.label, x + barWidth / 2, height - 10);
      });
    }

    // ===== XU·∫§T TI·∫æN ƒê·ªò =====
    async function exportProgress() {
      try {
        const progress = await getProgress();
        const dataStr = JSON.stringify(progress, null, 2);
        const dataBlob = new Blob([dataStr], { type: 'application/json' });
        const url = URL.createObjectURL(dataBlob);
        const link = document.createElement('a');
        link.href = url;
        const timestamp = new Date().toISOString().replace(/[:.]/g, '-').slice(0, 19);
        link.download = `progress_${timestamp}.json`;
        document.body.appendChild(link);
        link.click();
        document.body.removeChild(link);
        URL.revokeObjectURL(url);
        alert('‚úÖ ƒê√£ xu·∫•t file ti·∫øn ƒë·ªô!');
      } catch (e) {
        console.error("L·ªói xu·∫•t ti·∫øn ƒë·ªô:", e);
        alert('‚ùå L·ªói xu·∫•t ti·∫øn ƒë·ªô: ' + e.message);
      }
    }

    // ===== HI·ªÇN TH·ªä DASHBOARD =====
    async function showDashboard() {
      try {
        const progress = await getProgress();
        const lessonsData = await getLessonsData();
        const stats = calculateLearningStats(progress, lessonsData);

        const dashboardHTML = `
          <div class="row">
            <!-- T·ªïng quan -->
            <div class="col-md-6 mb-4">
              <div class="card h-100">
                <div class="card-header bg-primary text-white">
                  <h5 class="mb-0">üìä T·ªïng quan h·ªçc t·∫≠p</h5>
                </div>
                <div class="card-body">
                  <div class="row text-center mb-3">
                    <div class="col-4">
                      <div class="stat-item">
                        <h3 class="text-primary">${stats.totalItems}</h3>
                        <small>T·ªïng t·ª´/c√¢u</small>
                      </div>
                    </div>
                    <div class="col-4">
                      <div class="stat-item">
                        <h3 class="text-success">${stats.masteredItems}</h3>
                        <small>üü¢ Th√†nh th·∫°o</small>
                      </div>
                    </div>
                    <div class="col-4">
                      <div class="stat-item">
                        <h3 class="text-muted">${stats.newItems}</h3>
                        <small>‚ö´ Ch∆∞a h·ªçc</small>
                      </div>
                    </div>
                  </div>
                  
                  <hr class="my-3">
                  
                  <div class="row text-center small">
                    <div class="col-3">
                      <div class="stat-item py-2">
                        <h5 class="text-info mb-1">${stats.goodItems}</h5>
                        <small>üîµ T·ªët</small>
                      </div>
                    </div>
                    <div class="col-3">
                      <div class="stat-item py-2">
                        <h5 class="text-danger mb-1">${stats.needReviewItems}</h5>
                        <small>üî¥ C·∫ßn √¥n</small>
                      </div>
                    </div>
                    <div class="col-3">
                      <div class="stat-item py-2">
                        <h5 class="text-warning mb-1">${stats.averageItems}</h5>
                        <small>üü° TB</small>
                      </div>
                    </div>
                    <div class="col-3">
                      <div class="stat-item py-2">
                        <h5 class="text-secondary mb-1">${stats.weakItems}</h5>
                        <small>‚ö™ Y·∫øu</small>
                      </div>
                    </div>
                  </div>
                  
                  <div class="mt-3">
                    <div class="progress" style="height: 25px;">
                      <div class="progress-bar bg-success" style="width: ${stats.masteryPercentage}%" title="Th√†nh th·∫°o: ${stats.masteredItems}">
                        ${stats.masteryPercentage > 5 ? stats.masteredItems : ''}
                      </div>
                      <div class="progress-bar bg-info" style="width: ${(stats.goodItems / stats.totalItems * 100).toFixed(1)}%" title="T·ªët: ${stats.goodItems}">
                        ${stats.goodItems > 0 && stats.goodItems / stats.totalItems * 100 > 5 ? stats.goodItems : ''}
                      </div>
                      <div class="progress-bar bg-danger" style="width: ${(stats.needReviewItems / stats.totalItems * 100).toFixed(1)}%" title="C·∫ßn √¥n: ${stats.needReviewItems}">
                        ${stats.needReviewItems > 0 && stats.needReviewItems / stats.totalItems * 100 > 5 ? stats.needReviewItems : ''}
                      </div>
                      <div class="progress-bar bg-warning" style="width: ${(stats.averageItems / stats.totalItems * 100).toFixed(1)}%" title="Trung b√¨nh: ${stats.averageItems}">
                        ${stats.averageItems > 0 && stats.averageItems / stats.totalItems * 100 > 5 ? stats.averageItems : ''}
                      </div>
                      <div class="progress-bar bg-secondary" style="width: ${(stats.weakItems / stats.totalItems * 100).toFixed(1)}%" title="Y·∫øu: ${stats.weakItems}">
                        ${stats.weakItems > 0 && stats.weakItems / stats.totalItems * 100 > 5 ? stats.weakItems : ''}
                      </div>
                    </div>
                    <small class="text-muted">T·ª∑ l·ªá th√†nh th·∫°o: ${stats.masteryPercentage}% (${stats.masteredItems}/${stats.totalItems})</small>
                  </div>
                </div>
              </div>
            </div>
            
            <!-- Ti·∫øn ƒë·ªô theo b√†i -->
            <div class="col-md-6 mb-4">
              <div class="card h-100">
                <div class="card-header bg-info text-white">
                  <h5 class="mb-0">üìö Ti·∫øn ƒë·ªô theo b√†i</h5>
                </div>
                <div class="card-body" style="max-height: 400px; overflow-y: auto;">
                  ${generateLessonProgressHTML(stats.lessonStats, lessonsData)}
                </div>
              </div>
            </div>
          </div>
          
          <!-- Bi·ªÉu ƒë·ªì ti·∫øn ƒë·ªô -->
          <div class="row">
            <div class="col-12 mb-4">
              <div class="card">
                <div class="card-header bg-success text-white">
                  <h5 class="mb-0">üìà Bi·ªÉu ƒë·ªì ti·∫øn ƒë·ªô 7 ng√†y qua</h5>
                </div>
                <div class="card-body">
                  <canvas id="progressChart" width="800" height="300"></canvas>
                </div>
              </div>
            </div>
          </div>
          
          <!-- Danh s√°ch c·∫ßn √¥n -->
          <div class="row">
            <div class="col-12 mb-4">
              <div class="card">
                <div class="card-header bg-warning text-dark">
                  <h5 class="mb-0">‚è∞ C·∫ßn √¥n luy·ªán</h5>
                </div>
                <div class="card-body">
                  ${generateReviewListHTML(stats.dueItems)}
                </div>
              </div>
            </div>
          </div>
          
          <!-- Th√†nh t√≠ch -->
          <div class="row">
            <div class="col-12 mb-4">
              <div class="card">
                <div class="card-header bg-danger text-white">
                  <h5 class="mb-0">üèÜ Th√†nh t√≠ch</h5>
                </div>
                <div class="card-body">
                  ${generateAchievementsHTML(stats.achievements)}
                </div>
              </div>
            </div>
          </div>
          
          <div class="text-center mt-4">
            <a href="../index.html" class="btn btn-primary me-2">üìö V·ªÅ trang ch·ªß</a>
            <a href="../index.html#review" class="btn btn-success me-2">üîÑ √în luy·ªán</a>
            <button class="btn btn-info" onclick="exportProgress()">üíæ Xu·∫•t ti·∫øn ƒë·ªô</button>
          </div>
        `;

        document.getElementById('dashboard-content').innerHTML = dashboardHTML;

        // V·∫Ω bi·ªÉu ƒë·ªì sau khi render
        setTimeout(() => {
          drawProgressChart(stats.dailyProgress);
        }, 100);

      } catch (e) {
        console.error("L·ªói hi·ªÉn th·ªã dashboard:", e);
        document.getElementById('dashboard-content').innerHTML = `
          <div class="alert alert-danger">
            <h4>‚ö†Ô∏è L·ªói</h4>
            <p>Kh√¥ng th·ªÉ t·∫£i d·ªØ li·ªáu: ${e.message}</p>
            <a href="../index.html" class="btn btn-primary">üè† V·ªÅ trang ch·ªß</a>
          </div>
        `;
      }
    }

    // T·∫£i dashboard khi trang load
    window.addEventListener('DOMContentLoaded', async () => {
      // 1. Load Config first to get User ID
      try {
        const configRes = await fetch('../config.json');
        const CONFIG = await configRes.json();

        // 2. Init Firebase with Config User ID
        await initFirebase(CONFIG.user_id);
      } catch (e) {
        console.warn('Cannot load config.json, using default/auth ID', e);
        await initFirebase();
      }

      showDashboard();
    });

    // ===== FIREBASE INTEGRATION =====
    async function initFirebase(configUserId) {
      try {
        if (typeof ProgressManager !== 'undefined') {
          await ProgressManager.init(configUserId);
          console.log('‚úÖ Firebase initialized for dashboard.html');
        } else {
          console.warn('‚ö†Ô∏è ProgressManager not loaded');
        }
      } catch (error) {
        console.error('‚ùå Firebase init error:', error);
      }
    }
  </script>

  <!-- ===== Firebase CDN ===== -->
  <script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-app-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-database-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-auth-compat.js"></script>

  <!-- ===== Firebase Config & Progress Manager ===== -->
  <script src="../js/firebase-config.js"></script>
  <script src="../js/quiz-progress.js"></script>
</body>

</html>